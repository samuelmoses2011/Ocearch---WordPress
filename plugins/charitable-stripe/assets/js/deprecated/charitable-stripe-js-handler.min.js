!function(a){var t,e,o=function(e,o){o.error?alert(o.error.message):(t.find("[name=stripe_token]").val(o.id),a("body").off("submit","#charitable-donation-form-modal-loop #charitable-donation-form[data-use-ajax=1]",i),t.attr("data-use-ajax",1).trigger("submit"),a("body").on("submit","#charitable-donation-form-modal-loop #charitable-donation-form[data-use-ajax=1]",i))},r=function(a){"stripe"===new CHARITABLE.Donation_Form(a).get_payment_method()&&a.attr("data-use-ajax",0)},i=function(t){return t.stopImmediatePropagation(),r(a(this)),a("body").off("submit","#charitable-donation-form-modal-loop #charitable-donation-form[data-use-ajax=1]",i),a(this).trigger("submit"),a("body").on("submit","#charitable-donation-form-modal-loop #charitable-donation-form[data-use-ajax=1]",i),!1};a("body").on("submit","#charitable-donation-form-modal-loop #charitable-donation-form[data-use-ajax=1]",i),a("body").on("submit","#charitable-donation-form[data-use-ajax=0]",function(r){t=a(this);var i=(e=new CHARITABLE.Donation_Form(t)).get_cc_number(),n=e.get_cc_cvc(),c=e.get_cc_expiry_month(),d=e.get_cc_expiry_year();return e.clear_cc_fields(),"stripe"!==e.get_payment_method()||(r.preventDefault(),e.validate()?Stripe.card.validateCardNumber(i)?Stripe.card.validateExpiry(c,d)?(Stripe.card.createToken({number:i,cvc:n,exp_month:c,exp_year:d},o),!1):(alert(CHARITABLE_VARS.error_invalid_cc_expiry),!1):(alert(CHARITABLE_VARS.error_invalid_cc_number),!1):(alert(e.get_error_message()),!1))}),a("body").on("change","#charitable-gateway-selector input[name=gateway]",function(){r(a(this).parents("#charitable-donation-form"))}),a(document).ready(function(){Stripe.setPublishableKey(CHARITABLE_STRIPE_VARS.key);var t=a("#charitable-donation-form");t.length&&r(t),a("#charitable-gateway-selector input[name=gateway]").trigger("change")})}(jQuery);